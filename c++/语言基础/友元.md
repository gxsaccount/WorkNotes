# 1.友元函数的简单介绍 #
## 1.1为什么要使用友元函数 ##

在实现类之间数据共享时，减少系统开销，提高效率。  
如果类A中的函数要访问类B中的成员（例如：智能指针类的实现），那么类A中该函数要是类B的友元函数。  
具体来说：为了使其他类的成员函数直接访问该类的私有变量。  
即：允许外面的类或函数去访问类的私有变量和保护变量，从而使两个类共享同一函数。  
实际上具体大概有下面两种情况需要使用友元函数：  
（1）运算符重载的某些场合需要使用友元。  
（2）两个类要共享数据的时候。  
## 1.2使用友元函数的优缺点 ##  
**优点**：能够提高效率，表达简单、清晰。  
**缺点**：友元函数破环了封装机制，尽量不使用成员函数，除非不得已的情况下才使用友元函数。  
# 2.友元函数的使用 #  
## 2.1友元函数的参数： ##  
因为友元函数没有this指针，则参数要有三种情况：  
（1）要访问非static成员时，需要对象做参数；  
（2）要访问static成员或全局变量时，则不需要对象做参数；  
（3）如果做参数的对象是全局对象，则不需要对象做参数；  
## 2.2友元函数的位置 ##  
因为友元函数是类外的函数，所以它的声明可以放在类的私有段或公有段且没有区别。  
## 2.3友元函数的调用 ##  
可以直接调用友元函数，不需要通过对象或指针  
## 2.4友元函数的分类： ##  
根据这个函数的来源不同，可以分为三种方法：  
（1）普通函数友元函数：  
目的：使普通函数能够访问类的友元  
语法：  
声明： friend + 普通函数声明  
实现位置：可以在类外或类中  
实现代码：与普通函数相同  
调用：类似普通函数，直接调用  
代码：略  
（2）类Y的所有成员函数都为类X友元函数—**友元类**  
目的：使用单个声明使Y类的所有函数成为类X的友元，它提供一种类之间合作的一种方式，使类Y的对象可以具有类X和类Y的功能。  
语法：  
声明位置：公有私有均可，常写为私有(把类看成一个变量)  
声明： friend + 类名（不是对象哦）  
代码：  

    class girl;
    class boy
    {
    public:
      void disp(girl &);
    };

    void boy::disp(girl &x) //函数disp()为类boy的成员函数，也是类girl的友元函数
    {
      cout<<"girl's name is:"<<x.name<<",age:"<<x.age<<endl;//借助友元，在boy的成员函数disp中，借助girl的对象，直接访问girl的私有变量
    }

    class girl
    {
    private：
      char *name;
      int age;
      friend boy; //声明类boy是类girl的友元
    };

（3）类Y的一个成员函数为类X的友元函数  
目的：使类Y的一个成员函数成为类X的友元，具体而言：在类Y的这个成员函数中，借助参数X，可以直接以X的私有变量  
语法：  
声明位置：声明在公有中 （本身为函数）  
声明：friend + 成员函数的声明  
调用：先定义Y的对象y---使用y调用自己的成员函数---自己的成员函数中使用了友元机制  
代码：  
实现代码和2.4.2.3中的实现及其相似只是设置友元的时候变为friend void boy::disp(girl &);  

小结：其实一些操作符的重载实现也是要在类外实现的，那么通常这样的话，声明为类的友元是必须滴。  
4.友元函数和类的成员函数的区别  
4.1 成员函数有this指针，而友元函数没有this指针。  
4.2 友元函数是不能被继承的，就像父亲的朋友未必是儿子的朋友。  

注意：  
1.类中通过使用关键字friend 来修饰友元函数，但该函数并不是类的成员函数，其声明可以放在类的私有部分，也可放在共有部分。友元函数的定义在类体外实现，不需要加类限定。  
2.一个类中的成员函数可以是另外一个类的友元函数，而且一个函数可以是多个类友元函数。  
3.友元函数可以访问类中的私有成员和其他数据，但是访问不可直接使用数据成员，需要通过对对象进行引用。  
4.友元函数在调用上同一般函数一样，不必通过对对象进行引用。  
例如如下形式：这里解释上面的1，3，4要点的使用，加以理解。  

    class persion{
    public:
          persion(char *pn);

          //友元函数;
          friend void setweigth(persion &p,int h);//注意，参数列表中一般会有一个引用类型的形参,原因参考上面的使用要点3和4;
          void disp(); //类成员函数
    private:
          char name[20];
          int weigth,age;      
    };

    persion::persion(char *pn)   //构造函数
    {
       strcpy(name,pn);
       weigth=0;
    }
    void persion::disp()
    {
      cout<<name<<"--"<<weigth<<endl;
    }

    //友元函数的具体实现：这里没有类限定例如 (perion::setweigth)这种形式,这里可以与上面的disp()做个对比，一个属于类的成员，有限定，不属于类的成员函数，没有加限定。
    void setweigth(persion &pn,int w)
    {
      strcpy(pn.name,pn);//实现字符串复制
      pn.weigth=w;       //私有成员数据赋值

    }

    void  main()
    {
      persion p("zhansan");
      //调用实现setweigth(),与一般函数调用一致。
      setweigth(p,60);
      p.disp();  //调用类的成员函数。
    }

关于要点2的使用，我给出一段代码案例：  

    class wheel;
    class car{
    public:
        car(char *pn);
        void run(wheel &w);    //成员函数，做成wheel类中友元函数实现
    private:
        char name[20];

    };
    car::car(char *pn)
    {
    strcpy(name,pn);
    }

    class wheel{
    public:
        wheel(int s);
        friend void car::run(wheel &w);   //这里把car类的成员函数做了友元函数。
    private:
        int speed;
    };
    wheel::wheel(int s)
    {
      speed=s;
    }
    int  main(int argc, char const *argv[])
    {
        wheel w(60);
        car c("New car");
        c.run(w);
        return 0;
    }

    void car::run(wheel &w)   //car类成员函数的实现
    {
        cout<<"the car is running"<<endl;
        cout<<"name: "<<name<<" speed :"<<w.speed<<endl;
    }

另外：

    C++中引入友元函数，是为在该类中提供一个对外（除了他自己意外）访问的窗口;
    这个友元函数他不属于该类的成员函数，他是定义在类外的普通函数，只是在类中声明该函数可以直接访问类中的private或者protected成员。
    将数据和处理数据的函数封装在一起，构成类，实现了数据的隐藏，无疑是面向对象程序设计的一大优点。但是有时候封装不是绝对的。
    友元函数提供了不同类或对象的成员函数之间、类的成员函数和一般函数之间进行数据共享的机制。通俗的说，友元关系就是一个类主动声明哪些类或函数是它的朋友，进而给它们提供对本类的访问特性。也就是说，通过友元关系，一个普通函数或者类的成员函数可以访问封装于另外一个类中的数据。
    从一定程度上讲，友元是对数据隐藏和封装的破坏，但是为了数据共享，提高程序的效率和可读性，很多情况下这种小的破坏是必要的。
    在一个类中，利用关键字friend将其它函数或类声明为友元。如果友元是一般函数或类的成员函数，称为友元函数。如果友元是一个类，则称为友元类。友元类的所有成员函数都自动称为友元函数。
