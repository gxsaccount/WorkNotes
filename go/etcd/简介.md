# 特性 #  
将数据存储在集群中的高可用**K-V存储**。  
允许应用**实时监听**存储中的K-V变化。  
能**容忍单点故障**，能应对网络分区（多个节点中几个节点网线切断，系统人然可以运行下去）。  
底层存储是按key有序排列的，可以**顺序遍历**  
因为key有序，所以etcd天然支持按目录结构高效遍历  
**支持复杂事务**，提供类似if...then..else...的事务能力  
基于**租约机制**实现key的TTL过期  
# etcd原理 #
传统存储模型主从库的缺点，一个主对应多个从，主宕机从升级，解决了单点存储缺点。
1。但是这个**升级会有时间间隔**，使得这段时间用户不能写入。  
2。主从会有**同步延迟**，主宕机，数据可能会丢失。
## key有序存储 ## 
这样可以用前缀形成类似于目录结构的排序  
## MVCC多版本控制 ##  
提交版本（revision）在etcd中单调递增。  
同key维护多个历史版本，用于实现watch机制，背覆盖的数据也可以被找到。  
历史版本过多，可以通过执行compact命令完成删减。  
## 监听KV变化 ##  
通过watch机制可以监听某个key或者某个目录（key前缀）的连续变化，常用于分布式的配置分发、状态同步  
## watch工作原理 ##  
[]
存入新的k-v时，可以利用watcher线程从历史中找出对应k的历史版本。
## lease租约 ##  
租约过期后会删除，要想不删除，就得用keepAlive续租。  
## 交互协议 ##  
通用的HTTP+JSON协议，性能低效  
SDK内置GRPC协议，性能高效（IDL，HTTP/2，Protobuffer3）

## raft算法 ##  
强一致性的集群日志同步算法/分布式协议。  
etcd利用raft算法在集群中同步key-value  
提交的请求一定不会丢  
各个节点的数据最终一致。  

## quorum模型 ##  
大多数模型，集群需要2N+1节点
1。调用者调用，leader收到请求  
2。leader将日志复制给N+1个节点，（**实时日志复制**，写入性能较差）    
3。leader本地提交，返回客户端成功与否
4。**异步通知**follower完成提交  

## raft异常场景 ##




